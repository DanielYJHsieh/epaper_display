# WiFi SPI Display - 整合測試指南

## 📊 當前狀態

✅ **Server 端**: 已啟動，監聽 192.168.0.43:8266  
✅ **ESP8266**: 已連線，IP 192.168.0.160  
✅ **記憶體**: 48712 bytes 可用（健康）  
✅ **WebSocket**: 已連接

---

## 🧪 測試項目

### 測試 1: 發送文字訊息

#### Server 端操作
在 Server 的互動提示符 `>>>` 輸入：
```
text Hello ESP8266!
```

#### 預期 ESP8266 序列埠輸出
```
收到二進位資料: XXX bytes
處理封包: Type=FULL_UPDATE, SeqID=1, Length=XXX
處理完整更新...
可用記憶體: XXXXX bytes
✓ 記憶體分配成功
解壓縮中...
解壓縮完成: XX ms
更新顯示中...
顯示更新耗時: XXXX ms
總耗時: XXXX ms
發送 ACK: SeqID=1
```

#### 預期 Server 端輸出
```
收到 ACK: SeqID=1, 狀態=成功
✓ 發送完成
```

#### 預期電子紙顯示
應該看到 "Hello ESP8266!" 文字顯示在電子紙上。

---

### 測試 2: 發送測試圖案

#### Server 端操作
```
test
```

#### 預期結果
- ESP8266 收到封包並解壓縮
- 電子紙顯示測試圖案（條紋、方格等）
- Server 收到 ACK 確認

---

### 測試 3: 清空螢幕

#### Server 端操作
```
clear
```

#### 預期結果
- 電子紙變成全白
- ESP8266 序列埠顯示 "清空螢幕"

---

### 測試 4: 發送圖片（如果有圖片檔案）

#### 準備圖片
準備一張任意大小的圖片（JPG/PNG），例如 `test.jpg`

#### Server 端操作
```
image path/to/test.jpg
```

#### 預期結果
- Server 自動調整圖片為 800×480
- 轉換為黑白
- 壓縮並發送
- 電子紙顯示圖片

---

### 測試 5: 查看連接狀態

#### Server 端操作
```
clients
```

#### 預期輸出
```
已連接的客戶端 (1):
  1. 192.168.0.160 - 連接時間: XX 秒
```

---

## 📈 效能指標

### 預期時間（參考值）

| 項目 | 時間 | 說明 |
|------|------|------|
| 壓縮 | < 100ms | Server 端 RLE 壓縮 |
| 傳輸 | 500-1000ms | WiFi 傳輸（取決於壓縮率） |
| 解壓縮 | 100-300ms | ESP8266 RLE 解壓縮 |
| 顯示 | 2500-3500ms | 電子紙刷新時間（硬體限制） |
| **總計** | **3-5 秒** | 端到端時間 |

### 壓縮率（參考值）

| 內容類型 | 原始大小 | 壓縮後 | 壓縮率 |
|----------|----------|--------|--------|
| 純文字 | 48000 | 3000-5000 | 90-95% |
| 簡單圖形 | 48000 | 5000-10000 | 80-90% |
| 複雜圖片 | 48000 | 15000-20000 | 60-70% |

### 記憶體使用

| 階段 | 可用記憶體 | 說明 |
|------|-----------|------|
| 初始化 | ~48KB | 啟動完成 |
| 分配緩衝 | ~0-5KB | 分配 48KB currentFrame |
| 運行中 | ~0-5KB | 穩定運行 |

---

## ⚠️ 故障排除

### 問題 1: ESP8266 沒有收到封包
**檢查項目**:
- ESP8266 序列埠是否顯示 "WebSocket 已連線"
- Server 端 `clients` 指令是否顯示連接
- 防火牆是否阻擋 8266 埠

**解決方法**:
- 重啟 ESP8266
- 檢查網路連接
- 關閉防火牆測試

### 問題 2: 記憶體不足
**症狀**: 
```
可用記憶體: XXX bytes
記憶體分配失敗！
```

**解決方法**:
- 檢查是否有記憶體洩漏
- 確認 GxEPD2 模板參數為 `<..., 1>`
- 重啟 ESP8266

### 問題 3: 顯示不正確
**可能原因**:
- 解壓縮錯誤
- 資料傳輸遺失
- 顯示器驅動問題

**解決方法**:
- 查看序列埠錯誤訊息
- 檢查 ACK/NAK 狀態
- 嘗試重新發送

### 問題 4: 顯示速度慢
**正常情況**: 
- 電子紙刷新需要 2.5-3.5 秒（硬體限制）
- 這是正常的，無法加速

**如果超過 5 秒**:
- 檢查 WiFi 訊號強度（應 > -70 dBm）
- 檢查網路頻寬
- 查看壓縮率（可能資料太大）

### 問題 5: Server 沒有收到 ACK
**症狀**:
```
✗ 未收到 ACK
```

**解決方法**:
- 檢查 ESP8266 是否發送 ACK（查看序列埠）
- 檢查網路連接
- 增加超時時間

---

## 📝 測試記錄範例

```
測試日期: 2024-10-04
測試人員: [你的名字]

【環境】
- PC IP: 192.168.0.43
- ESP8266 IP: 192.168.0.160
- WiFi 訊號: -58 dBm
- 可用記憶體: 48712 bytes

【測試 1: 文字訊息】
- 指令: text Hello ESP8266!
- 壓縮率: 92%
- 傳輸時間: 650ms
- 解壓時間: 120ms
- 顯示時間: 3200ms
- 總耗時: 3970ms
- 結果: ✅ 通過

【測試 2: 測試圖案】
- 指令: test
- 壓縮率: 88%
- 總耗時: 4100ms
- 結果: ✅ 通過

【測試 3: 清空螢幕】
- 指令: clear
- 結果: ✅ 通過

【測試 4: 圖片】
- 指令: image test.jpg
- 原始大小: 48000 bytes
- 壓縮後: 16500 bytes (65% 壓縮率)
- 總耗時: 4500ms
- 結果: ✅ 通過

【總結】
✅ 所有測試通過
✅ 效能符合預期
✅ 記憶體使用正常
```

---

## 🎯 驗收標準

### 必須通過
- [x] ESP8266 能穩定連接到 Server
- [x] 記憶體使用正常（> 25KB 可用）
- [ ] 能正確接收並顯示文字
- [ ] 能正確接收並顯示測試圖案
- [ ] ACK/NAK 機制正常運作
- [ ] 無記憶體洩漏（長時間運行穩定）

### 效能要求
- [ ] 壓縮率 > 60%（複雜圖片）
- [ ] 壓縮率 > 85%（文字）
- [ ] 端到端時間 < 5 秒
- [ ] 記憶體使用 < 50KB

### 穩定性
- [ ] 連續發送 10 次無錯誤
- [ ] 運行 10 分鐘無崩潰
- [ ] WiFi 斷線能自動重連

---

## 🚀 下一步

測試通過後：
1. 記錄所有測試結果
2. 截圖電子紙顯示效果
3. 準備上傳到 GitHub
4. 撰寫專案文檔

---

**準備好了嗎？開始測試吧！** 🎉
