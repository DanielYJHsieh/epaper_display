# 顯示解析度評估報告

## 當前狀態
- **目前解析度**: 400×240 (使用 800×480 顯示器的中央部分)
- **緩衝區大小**: 12,000 bytes (400×240÷8)
- **RAM 使用率**: 37% (30,428 / 80,192 bytes)
- **可用 RAM**: ~49,764 bytes

## 記憶體分析

### ESP8266 記憶體限制
- **總 RAM**: 80,192 bytes
- **目前使用**: 30,428 bytes (37%)
  - DATA: 1,500 bytes (初始化變數)
  - RODATA: 2,088 bytes (常數)
  - BSS: 26,840 bytes (零初始化變數)
- **剩餘可用**: ~49,764 bytes

### 記憶體保留需求
- **網路緩衝區**: ~8,000 bytes (WiFi + WebSocket)
- **堆疊空間**: ~4,000 bytes (函數調用)
- **臨時緩衝區**: ~2,000 bytes (RLE 解壓縮等)
- **安全邊界**: ~3,000 bytes
- **總保留**: ~17,000 bytes

### 可用於顯示緩衝區的記憶體
**最大可用**: 49,764 - 17,000 = **32,764 bytes**

## 解析度選項分析

### 選項 1: 400×240 (目前)
- **緩衝區**: 12,000 bytes
- **使用率**: 36.6% of available display buffer memory
- **狀態**: ✅ **非常安全**
- **優點**: 
  - 記憶體充裕
  - 運行穩定
  - 快速更新
- **缺點**: 
  - 未充分利用 800×480 顯示器
  - 只使用顯示器的 25% 面積

### 選項 2: 480×320
- **緩衝區**: 19,200 bytes (480×320÷8)
- **使用率**: 58.6% of available display buffer memory
- **狀態**: ✅ **安全**
- **優點**:
  - 增加 60% 顯示面積
  - 更好的顯示效果
  - 仍有充足的記憶體邊界
- **缺點**:
  - 網路傳輸時間增加
  - 更新速度稍慢

### 選項 3: 560×336 (7:1 縮小)
- **緩衝區**: 23,520 bytes (560×336÷8)
- **使用率**: 71.8% of available display buffer memory
- **狀態**: ✅ **可行**
- **優點**:
  - 接近 70% 顯示器面積使用率
  - 與 800×480 比例接近 (1.667 vs 1.667)
  - 仍有安全邊界
- **缺點**:
  - 記憶體使用較緊張
  - 傳輸和更新時間較長

### 選項 4: 600×400
- **緩衝區**: 30,000 bytes (600×400÷8)
- **使用率**: 91.6% of available display buffer memory
- **狀態**: ⚠️ **極限**
- **優點**:
  - 62.5% 顯示器面積
  - 與 800×480 相同寬高比 (3:2)
- **缺點**:
  - **記憶體非常緊張**
  - 幾乎無安全邊界
  - 可能導致記憶體分配失敗
  - 不建議使用

### 選項 5: 640×384
- **緩衝區**: 30,720 bytes (640×384÷8)
- **使用率**: 93.8% of available display buffer memory
- **狀態**: ❌ **不推薦**
- **優點**:
  - 4:1 縮小（與 800×480 接近）
- **缺點**:
  - **超出安全範圍**
  - 高風險記憶體溢位
  - 不穩定

### 選項 6: 800×480 (全尺寸)
- **緩衝區**: 48,000 bytes
- **使用率**: 146.5% of available display buffer memory
- **狀態**: ❌ **不可行**
- **原因**: 
  - **超出可用記憶體**
  - ESP8266 無法分配 48KB 連續記憶體
  - 已在 v1.0 測試中證實無法運作

## 建議方案

### 🏆 最佳平衡: 480×320
**推薦理由**:
1. ✅ 記憶體使用安全 (58.6%)
2. ✅ 顯示面積增加 60%
3. ✅ 保持充足的安全邊界
4. ✅ 網路傳輸時間可接受
5. ✅ 更新速度仍然快速

**實施建議**:
```cpp
// config.h
#define DISPLAY_WIDTH  480
#define DISPLAY_HEIGHT 320
#define DISPLAY_OFFSET_X ((PHYSICAL_WIDTH - DISPLAY_WIDTH) / 2)   // 160
#define DISPLAY_OFFSET_Y ((PHYSICAL_HEIGHT - DISPLAY_HEIGHT) / 2) // 80
#define DISPLAY_BUFFER_SIZE (DISPLAY_WIDTH * DISPLAY_HEIGHT / 8)  // 19200
```

### 🎯 進階選項: 560×336
**適用場景**: 需要更大顯示面積時
1. ⚠️ 記憶體使用較高 (71.8%)
2. ✅ 顯示面積接近 70%
3. ⚠️ 需要仔細測試穩定性
4. ⚠️ 網路傳輸時間較長

**實施建議**:
```cpp
// config.h
#define DISPLAY_WIDTH  560
#define DISPLAY_HEIGHT 336
#define DISPLAY_OFFSET_X ((PHYSICAL_WIDTH - DISPLAY_WIDTH) / 2)   // 120
#define DISPLAY_OFFSET_Y ((PHYSICAL_HEIGHT - DISPLAY_HEIGHT) / 2) // 72
#define DISPLAY_BUFFER_SIZE (DISPLAY_WIDTH * DISPLAY_HEIGHT / 8)  // 23520
```

### ⚠️ 極限測試: 600×400
**僅供實驗**: 需要最大顯示面積時
1. ❌ 記憶體使用極限 (91.6%)
2. ⚠️ 幾乎無安全邊界
3. ❌ 高風險，不建議生產使用
4. ⚠️ 可能導致系統不穩定

## 性能比較表

| 解析度 | 緩衝區(bytes) | 記憶體使用率 | 顯示面積比 | 傳輸時間(估計) | 建議 |
|--------|---------------|--------------|------------|----------------|------|
| 400×240 | 12,000 | 36.6% ✅ | 25.0% | 1.0× | 目前 |
| 480×320 | 19,200 | 58.6% ✅ | 40.0% | 1.6× | **推薦** |
| 560×336 | 23,520 | 71.8% ✅ | 49.0% | 2.0× | 進階 |
| 600×400 | 30,000 | 91.6% ⚠️ | 62.5% | 2.5× | 極限 |
| 640×384 | 30,720 | 93.8% ❌ | 64.0% | 2.6× | 不建議 |
| 800×480 | 48,000 | 146.5% ❌ | 100% | 4.0× | 不可行 |

## 實施步驟

### 升級到 480×320 (推薦)
1. 修改 `config.h`:
   - DISPLAY_WIDTH = 480
   - DISPLAY_HEIGHT = 320
   - 更新 OFFSET 計算
2. 修改 `image_processor.py`:
   - 更新預設解析度
3. 重新編譯並上傳
4. 測試穩定性和性能

### 測試檢查清單
- [ ] 編譯成功
- [ ] 上傳成功
- [ ] WiFi 連接正常
- [ ] 文字顯示正常
- [ ] 簡單圖片顯示正常
- [ ] 複雜圖片顯示正常
- [ ] 連續更新穩定
- [ ] 記憶體無洩漏
- [ ] 長時間運行穩定

## 結論

**目前 400×240**: 穩定但保守，只使用 25% 顯示器面積

**建議升級到 480×320**: 
- 增加 60% 顯示面積
- 記憶體使用安全
- 最佳性能與效果平衡

**可選測試 560×336**:
- 如需更大顯示面積
- 需要仔細測試穩定性

**不建議 600×400 以上**:
- 記憶體過於緊張
- 穩定性風險高
- 實際效益有限
